<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title data-translate="data_registration">Data Registration</title>
  <link rel="stylesheet" href="../css/style.css" />
  <link rel="stylesheet" href="../css/buttons.css" /> <!-- رابط لملف التنسيق الخاص بالأزرار -->
</head>
<body>
  <div class="container">

    <!-- Language selector -->
    <div class="header-flex" style="justify-content: flex-end; margin-bottom: 20px;">
      <select id="language-select" class="language-select" aria-label="Select Language">
        <option value="en">English</option>
        <option value="ar">العربية</option>
      </select>
    </div>

    <header>
      <h1 data-translate="data_registration">Data Registration</h1>
    </header>

    <!-- حقل البحث -->
    <input type="text" id="search" name="search" placeholder="Search data..." aria-label="Search" class="search-box"data-translate="search_data" />

    <form id="registerForm">
      <input type="text" id="idNumber" name="idNumber" placeholder="" data-translate="id_number" required />
      <input type="text" id="name" name="name" placeholder="" data-translate="name" autocomplete="name" required />
      
      <select id="gender" name="gender" required>
        <option value="" disabled selected data-translate="select_gender">Select Gender</option>
        <option value="male" data-translate="male">Male</option>
        <option value="female" data-translate="female">Female</option>
      </select>

      <input type="text" id="nationality" name="nationality" placeholder="" data-translate="nationality" required />
      <input type="email" id="email" name="email" placeholder="" data-translate="email" autocomplete="email" required />
      <input type="tel" id="phone" name="phone" placeholder="" data-translate="phone" autocomplete="tel" required />
      <input type="text" id="address" name="address" placeholder="" data-translate="address" autocomplete="street-address" required />

      <div class="form-buttons">
        <!-- أزرار التعديل والإرجاع والحذف -->
        <button type="button" class="btn btn-edit" data-translate="edit">Edit</button>
        <button type="button" class="btn btn-restore" data-translate="restore">Restore</button>
        <button type="button" class="btn btn-delete" data-translate="delete">Delete</button>
        <button type="button" class="btn btn-clear" data-translate="clear">Clear All</button>
        
        <!-- زر الحفظ / التقديم -->
        <button type="submit" class="btn btn-confirm" data-translate="submit">Submit</button>
      </div>
    </form>
  </div>

  <div style="margin-top: 30px;">
    <a href="../dashboard.html" class="btn" data-translate="back_home">Back to Home</a>
  </div>

  <script src="../js/translation.js"></script>
  <script src="../js/main.js"></script>
  <script src="../js/auth.js"></script> <!-- أو js/auth.js حسب المسار -->

  <script>
    translatePage();

    // Zoom functionality
    window.addEventListener("wheel", (e) => {
      if (e.ctrlKey) {
        e.preventDefault();
        let scale = Number(document.body.style.zoom) || 1;
        scale += e.deltaY < 0 ? 0.1 : -0.1;
        scale = Math.min(Math.max(0.5, scale), 2);
        document.body.style.zoom = scale;
      }
    }, { passive: false });

    // Load saved data if available
    const form = document.getElementById("registerForm");
    const fields = ["idNumber", "name", "gender", "nationality", "email", "phone", "address"];

    window.addEventListener("load", () => {
      fields.forEach((field) => {
        if (localStorage.getItem(field)) {
          form[field].value = localStorage.getItem(field);
        }
      });
    });

    // ✅ أولاً: ربط زر Submit بعملية الإرسال إلى الـ API
    
    // form.addEventListener("submit", (e) => {
    //   e.preventDefault();
    //   fields.forEach((field) => {
    //     localStorage.setItem(field, form[field].value);
    //   });
    //   alert("تم حفظ جميع البيانات! (محاكاة التسجيل)");
    // });

  form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const payload = {
    full_name: form.name.value,
    id_number: form.idNumber.value,
    gender: form.gender.value,
    nationality: form.nationality.value,
    email: form.email.value,
    phone: form.phone.value,
    address: form.address.value,
  };

  try {
    // const response = await fetch("http://localhost:3000/api/data-entry", {
    const response = await fetch("http://localhost:5000/api/data-entry", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
    });

    if (response.ok) {
      alert("✅ تم حفظ البيانات بنجاح!");
      form.reset();
    } else {
      alert("❌ فشل الحفظ.");
    }
  } catch (error) {
    console.error(error);
    alert("❌ خطأ أثناء الاتصال بالخادم.");
  }
});


    // Language selector functionality
    document.addEventListener("DOMContentLoaded", () => {
      const select = document.getElementById("language-select");
      if (select) {
        select.value = localStorage.getItem("lang") || (navigator.language.startsWith("ar") ? "ar" : "en");
        select.addEventListener("change", (e) => {
          localStorage.setItem("lang", e.target.value);
          translatePage();
          document.documentElement.dir = e.target.value === "ar" ? "rtl" : "ltr";
          document.body.style.textAlign = e.target.value === "ar" ? "right" : "left";
        });
      }
    });
  </script>
</body>
</html>
